<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ePayco Variables</title>
</head>
<body>
    <h1>Test de Variables de ePayco</h1>
    <div id="results"></div>

    <script>
        async function testEpaycoAPI() {
            const results = [];

            // 1. Verificar que el script de ePayco se cargÃ³
            results.push({
                test: '1. Script de ePayco cargado',
                result: typeof window.ePayco !== 'undefined' ? 'âœ… SÃ' : 'âŒ NO',
                details: typeof window.ePayco !== 'undefined' ? 'window.ePayco estÃ¡ disponible' : 'window.ePayco no estÃ¡ disponible'
            });

            // 2. Verificar que el endpoint de API existe
            try {
                const response = await fetch('/api/payments/create', {
                    method: 'OPTIONS'
                });
                results.push({
                    test: '2. Endpoint /api/payments/create responde a OPTIONS',
                    result: response.ok ? 'âœ… SÃ' : `âŒ NO (${response.status})`,
                    details: `Status: ${response.status} ${response.statusText}`
                });
            } catch (error) {
                results.push({
                    test: '2. Endpoint /api/payments/create responde a OPTIONS',
                    result: 'âŒ ERROR',
                    details: error.message
                });
            }

            // 3. Test de POST con datos mÃ­nimos
            try {
                const testData = {
                    cart: [{
                        id: 'test',
                        nombre: 'Producto Test',
                        precio: 1000,
                        cantidad: 1,
                        imagen: '/placeholder.png'
                    }],
                    customer: {
                        name: 'Test User',
                        email: 'test@test.com',
                        phone: '3001234567'
                    }
                };

                const response = await fetch('/api/payments/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                let data;
                try {
                    data = await response.json();
                } catch (e) {
                    data = { error: 'No JSON response', text: await response.text() };
                }

                results.push({
                    test: '3. Test de POST a /api/payments/create',
                    result: response.ok ? 'âœ… SÃ' : `âŒ NO (${response.status})`,
                    details: JSON.stringify(data, null, 2)
                });
            } catch (error) {
                results.push({
                    test: '3. Test de POST a /api/payments/create',
                    result: 'âŒ ERROR',
                    details: error.message
                });
            }

            // Mostrar resultados
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = results.map(r => `
                <div style="margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px;">
                    <h3>${r.test}</h3>
                    <p style="font-size: 24px;">${r.result}</p>
                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto;">${r.details}</pre>
                </div>
            `).join('');

            // TambiÃ©n mostrar en consola
            console.log('ðŸ“‹ Resultados del test de ePayco:', results);
        }

        // Ejecutar test automÃ¡ticamente
        testEpaycoAPI();
    </script>
</body>
</html>
